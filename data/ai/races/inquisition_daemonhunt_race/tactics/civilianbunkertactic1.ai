----------------------------------------
-- File: 'civilianbunkertactic.ai'
-- Edited by Thudmeizer         @ 09.06.2016

class 'CivilianBunkerTactic' (BaseTactic)

CivilianBunker = {}

function CivilianBunkerTactic:__init( base_ai ) super( base_ai )

	self:SetName("Civilian Bunker Tactic")
end

function CivilianBunkerTactic:AutoBuildAddOn( addonSlot )
	local buildChannel = build_manager:GetBuildChannelFromID(self.base_ai:GetEntity():GetID())
    		if buildChannel ~= nil then
        	local addOnID = buildChannel:GetItemIDAt(BuildChannelAI.PQ_AddOn, addonSlot)
        		if (buildChannel:IsBuilding() == 0 and buildChannel:CanAddToQueue(BuildChannelAI.PQ_AddOn, addOnID) == BuildChannelAI.CANBUILD_Ok) then
            		buildChannel:BuildAddOn(addOnID)
        	end
	end
end

function CivilianBunkerTactic:InitAbilities()

	-- Init abilities
	if (CivilianBunker.repair_id == nil) then
        	CivilianBunker.repair_id = cpu_manager.stats:GetAbilityID( "all_autorepair" )
    	end

    	-- Init Ability ID's and Addon ID's
    	CivilianBunker.workerAddonID = cpu_manager.stats:GetAddOnID( "inquisition_dedication_workers_addon" )
    	CivilianBunker.tradingAddonID = cpu_manager.stats:GetAddOnID( "inquisition_dedication_trading_addon" )
    	CivilianBunker.squadAddonID = cpu_manager.stats:GetAddOnID( "inquisition_dedication_squad_addon" )
    	CivilianBunker.supportAddonID = cpu_manager.stats:GetAddOnID( "inquisition_dedication_support_addon" )
    	CivilianBunker.requisitionAddonID = cpu_manager.stats:GetAddOnID( "inquisition_dedication_requisition_addon" )
    	CivilianBunker.powerAddonID = cpu_manager.stats:GetAddOnID( "inquisition_dedication_power_addon" )
end

function CivilianBunkerTactic:DoAbilities()

    	-- Base Repair!
	if (self.base_ai:WasRecentlyHurt() and self.base_ai:GetHealthPercentage() < 0.6) then

		if (self.base_ai:CanDoAbility( CivilianBunker.repair_id )) then
           		self.base_ai:DoSpecialAbility( CivilianBunker.repair_id )
       		end
	end

	--    self:AutoBuildAddOn(0) -- Workers		-- inquisition_dedication_workers_addon
	--    self:AutoBuildAddOn(1) -- Trading		-- inquisition_dedication_trading_addon
	--    self:AutoBuildAddOn(2) -- Squad		-- inquisition_dedication_squad_addon
	--    self:AutoBuildAddOn(3) -- Support		-- inquisition_dedication_support_addon
	--    self:AutoBuildAddOn(4) -- Requisition	-- inquisition_dedication_requisition_addon
	--    self:AutoBuildAddOn(5) -- Power		-- inquisition_dedication_power_addon

   	if (cpu_manager:GetTierLevel() <= 3) then 

		local myTable1 = {0, 2, 3}
		local num1 = math.random(1, table.getn(myTable1))
		local result1 = myTable1[num1]
		self:AutoBuildAddOn(result1)
	end

   	if (cpu_manager:GetTierLevel() >= 4) then 

		local myTable2 = {0, 4, 5}
		local num2 = math.random(1, table.getn(myTable2))
		local result2 = myTable2[num2]
		self:AutoBuildAddOn(result2)
	end
end